---
title: "Penguin Cleaning"
output: html_document
date: "2026-02-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Load packages

```{r}
library(palmerpenguins)
library(dplyr)
library(stringr)
library(skimr)
```

## Goal

We will clean `penguins_raw` to create `penguins_new` so that it matches `penguins`.

## My list of tasks

1. Keep only necessary columns.
2. Rename columns to match `penguins`.
3. Convert long species names to short labels.
4. Standardize island capitalization.
5. Standardize sex formatting.
6. Create `year` from date.
7. Match factor levels exactly.
8. Remove extra attributes.
9. Match structure exactly.

## Inspect raw data

```{r}
head(penguins_raw)
str(penguins_raw)
skim(penguins_raw)
```

## Create penguins_new

```{r}
penguins_new <- penguins_raw |>
  select(
    Species,
    Island,
    `Culmen Length (mm)`,
    `Culmen Depth (mm)`,
    `Flipper Length (mm)`,
    `Body Mass (g)`,
    Sex,
    `Date Egg`
  ) |>
  rename(
    species = Species,
    island = Island,
    bill_length_mm = `Culmen Length (mm)`,
    bill_depth_mm = `Culmen Depth (mm)`,
    flipper_length_mm = `Flipper Length (mm)`,
    body_mass_g = `Body Mass (g)`,
    sex = Sex,
    date_egg = `Date Egg`
  ) |>
  mutate(
    species = case_when(
      str_detect(species, "Adelie") ~ "Adelie",
      str_detect(species, "Chinstrap") ~ "Chinstrap",
      str_detect(species, "Gentoo") ~ "Gentoo",
      TRUE ~ NA_character_
    ),
    island = str_to_title(island),
    sex = str_to_lower(sex),
    year = as.integer(format(date_egg, "%Y"))
  ) |>
  select(-date_egg) |>
  select(
    species,
    island,
    bill_length_mm,
    bill_depth_mm,
    flipper_length_mm,
    body_mass_g,
    sex,
    year
  )

# Match factor levels exactly
penguins_new <- penguins_new |>
  mutate(
    species = factor(species, levels = levels(penguins$species)),
    island  = factor(island,  levels = levels(penguins$island)),
    sex     = factor(sex,     levels = levels(penguins$sex))
  )

# Remove readr attribute
attr(penguins_new, "spec") <- NULL

# Convert to base data.frame to match structure
penguins_new <- as.data.frame(penguins_new)

# Match row names exactly
row.names(penguins_new) <- row.names(penguins)
```

## Test

```{r test}
identical(penguins, penguins_new)
all.equal(penguins, penguins_new)
```

## Special challenge

```{r}
penguins_new_extra <- penguins_raw |>
  transmute(
    clutch_completion = `Clutch Completion`
  )

head(penguins_new_extra)
```
